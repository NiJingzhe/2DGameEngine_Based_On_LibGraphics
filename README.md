# 2DGameEngine Based on LibGraphics

#### **一、介绍**
- 作为ZJU的C大程大作业的项目
- 引擎相关文件在`src`文件夹下的`2DGameEngine`文件夹中

#### **二、安装教程**

1. 请确保自己的`cmake`版本高于`3.8.0`
2. 我们提供了可以直接使用的`CMakeLists.txt`, 可以根据其中的注释修改后使用
3. 修改完`CMakeLists.txt`后，在当前文件夹执行 `cmake .` 即可生成`build`文件夹
4. 如果采用非MSVC编译器编译，可以通过执行`make install`直接将目标文件安装到`test_env`文件夹下
5. 请务必将`res`文件夹置于目标文件的启动目录下，否则将找不到相关资源
6. **总结：**
```bash
#在当前文件夹下
cmake .
cp -r ./res ./build/res
cp -r ./res ./test_env/res
cd build
make -j18 或 make install -j18
#之后根据自己的情况启动目标文件

# demo操作说明：AWSD操作蓝方移动，方向键操作红方移动
#               双方可以通过触碰对应的技能点获得技能
#               蓝方触碰蓝色技能点获得 冰冻 可以让红方速度减慢，通过空格键释放，释放后需要再次触碰技能点获得
#               红方触碰红色技能点后获得 瞬移，按Enter键通过鼠标选择瞬移方向，瞬移过程中自身碰撞箱无效，瞬移消耗头顶体力条。触碰一次技能点即可，后通过体力条判定是否能释放技能
#               蓝方目标：在倒计时结束前不被红方碰到
#               红方目标：在倒计时结束前碰到蓝方
```

#### **三、架构说明**
- *申明：本引擎依然存在诸多缺陷，仅仅作为大作业交差和自己平日玩乐的项目，如果跑着跑着出了什么问题都是很正常的*

- 本项目采用C实现**OOP**风格，有关**OOP**风格的具体规范在后文说明
- **架构图**
![架构图](./readme_resources/架构图.png)

#### **四、快速入门**
1. 项目结构
```bash
src
|
|---2DGameEngine              #引擎库
|
|---YourGameFolder            #你的项目
    | 
    |---game_conf.h           #对启动场景的设置
    |
    |---game.c                #游戏主体逻辑，与定时器回调函数
    |
    |---scene_info.h          #场景信息
    |
    |---scene1                #场景1文件夹
    |    |
    |    |---scene1.h         #场景1的public属性
    |    | 
    |    |---scene1.c         #场景1的创建和初始化函数
    |    |
    |    |---scene1_Actor1.h  #场景1的第一个演员的public属性
    |    |
    |    |---scene1_Actor1.c  #场景1的第一个演员的创建和初始化函数
    |     ...
    |
    |---scene2
    |    |
    |    |---scene2.h
    |    |
    |    |---scene2.c
    |    |
    |    |---scene2_Actor1.h
    |    |
    |    |---scene2_Actor1.c
    |     ...
    |
    | ...
```
2. 相关概念
- **场景**：游戏中的一个场景，可以理解为一个舞台

- **演员**：场景中的任何实体都被称作**演员**

- **组件**：不同**演员**需要具备不同的功能，有的可以检测碰撞，有的可以计时，有的可以显示UI，有的则负责被玩家控制，这些功能都是通过向**演员**添加各种**组件**来实现的

- **亚组件对象**：组件本身可能也是由一些提供功能和算法的对象组成的，这些对象被称作**亚组件对象**，任何**亚组件对象**都必须在创建并完成组件的构成或执行相应的计算功能后**立刻销毁**，否则会导致内存泄漏

- **当前场景**：本游戏引擎的窗口在同一时刻只能渲染一个**场景**，也只能同时对一个**场景**进行逻辑处理，这个**场景**就是**当前场景**

3. 游戏整体流程（详见`game.c`）
- **第一步**：`Main`函数执行初始化流程，初始化图形窗口，并根据`game_conf.h`中的设置创建第一个场景并将其载入内存，场景管理器将会把这个场景首先设定为**当前场景**

- **第二步**：程序本体开始进入游戏循环，首先判断事件队列是否为空，不为空则进行事件处理和分发，之后游戏引擎进入`EngineUpdate`函数，对**当前场景**执行更新逻辑，负责更新**场景**内每个**演员**的位置等相关属性，其中**演员**的具体更新逻辑默认是do nothing的，开发者可以根据需要自己重写相关**演员**的**更新函数**

- **第三步**：游戏引擎进入`Render`函数，对**当前场景**进行渲染，渲染的顺序由向**场景**内添加**演员**的顺序决定，**先添加的先渲染，先渲染的会被后渲染的遮挡**。其中**演员**的具体渲染逻辑默认是渲染自身每一个需要渲染的**组件**，开发者可以根据需要自己重写相关**演员**的**渲染函数**

*之后重复以上**第二步**和**第三步**，直到**窗体被关闭***

- **第四步**：若窗体被关闭，引擎进入`Free`函数，开销毁对象释放内存。从销毁**场景**开始，递归的销毁每个场景内的**演员**与它们的**组件**，直到所有**场景**完成销毁，程序退出。

4. 开发者要做什么？
- **第一步**：在`game_conf.h`中设置游戏的启动场景

- **第二步**：根据`demo`创建`game.c`

- **第三步**：根据`demo`创建`scene_info.h`

- **第四步**： 创建一个场景文件夹，并在其中创建对应的`scene.h`和`scene.c`，并将其包含到`scene_info.h`中

- **第五步**：在`scene.c`中实现`sceneCreate`函数，创建**场景**内的**演员**，并将其添加到场景中

- **第六步**：在`scene.h`中实现`setupScene`函数，该函数接受一个参数`param`来自**场景**间传参， 可以在该函数内更具`param`初始化**场景**本身的属性和其内的**演员**，该初始化过程包括指定相关**演员**的**更新函数**和**渲染函数**，对**演员**的创建和初始化需要调用封装与**演员**相关文件内的函数实现。

- **第七步**：创建相关演员的`.h`与`.c`完成对**演员**自身属性，**组件**，创建函数与初始化函数的定义与封装，并实现相关的**更新函数**和**渲染函数**

#### **参与贡献**

1.  Fork 本仓库
2.  新建 Feature_xxx 分支
3.  提交代码
4.  新建 Pull Request

